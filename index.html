<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>CODEHENGE</title>
        <link href="https://fonts.googleapis.com/css?family=Covered+By+Your+Grace" rel="stylesheet" type="text/css">
        <style>
            body, input {
                margin: 0px;
                font-family: 'Covered By Your Grace', serif;
            }
            canvas { width: 100%; height: 100%; display: block;}
            #a{
                background-image: url("http://3.bp.blogspot.com/-4oAWWCcNNz4/Tjr3nKNyVUI/AAAAAAAAPLU/Pouua-pNsEY/s1600/sq.gif");    
                width: 158px;
                height: 18px;
                background-size: 20px;
                border: none;
                font-family: monospace;
                font-size: 14px;
                padding-left: 6px;
                letter-spacing: 12px;
            }
            #b{
                background-image: url("http://3.bp.blogspot.com/-4oAWWCcNNz4/Tjr3nKNyVUI/AAAAAAAAPLU/Pouua-pNsEY/s1600/sq.gif");    
                width: 177px;
                height: 18px;
                background-size: 20px;
                border: none;
                font-family: monospace;
                font-size: 14px;
                padding-left: 6px;
                letter-spacing: 12px;
            }
            #info {
                font-family: 'Covered By Your Grace', serif;  
                font-size: 20pt;      
                position: absolute;
                width: 100%;
                text-align: center;
            }
            #info2 {
                font-family: 'Covered By Your Grace', serif;   
                font-size: 20pt;     
                position: absolute;
                width: 100%;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div id="info">CODEHENGE<br />
		enter the word hidden in the stones<br />
            <form onsubmit="return false;">
                <input type="text" id="a" value="" maxlength="8"><br>
                <input type="button" value="Submit" onclick="foo('a');" />
            </form>
        </div>
        <div id="info2">
		well done <br /> now enter the word formed by the druids<br />
            <form onsubmit="return false;">
                <input type="text" id="b" value="" maxlength="9"><br>
                <input type="button" value="Submit" onclick="foo('b');" />
            </form>
        </div>
        <script src="three.min.js"></script>
        <script src="OrbitControls.js"></script>
        <script src="OBJLoader.js"></script>
        <script type="text/javascript" src="sha3.js"></script>
        
        <script>
            var onedone = false;
            $('#info2').hide();
            var scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0xcce0ff, 1000, 5000);
            var camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.x = 1000;
            camera.position.y = 0;
            camera.position.z = 1500;
            scene.add(camera);
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(scene.fog.color);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            window.addEventListener('resize', onWindowResize, false);
            var controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.maxPolarAngle = Math.PI * 0.5;
            controls.minDistance = 1000;
            controls.maxDistance = 7500;
            var light = new THREE.HemisphereLight(0xffffbb, 0x080820, 1);
            scene.add(light);
            light = new THREE.DirectionalLight(0xdfebff, .6);
            light.position.set(50, 200, 100);
            light.position.multiplyScalar(1.3);
            light.castShadow = true;
            light.shadow.mapSize.width = 1024;
            light.shadow.mapSize.height = 1024;
            var d = 1000;
            light.shadow.camera.left = -d;
            light.shadow.camera.right = d;
            light.shadow.camera.top = d;
            light.shadow.camera.bottom = -d;
            light.shadow.camera.far = 1000;
            scene.add(light);
            function create(filename) {
                var btex = new THREE.Texture();
                var loader = new THREE.ImageLoader(manager);
                loader.load('hengemap.jpg', function (image) {
                    btex.image = image;
                    btex.needsUpdate = true;
                });
                var manager = new THREE.LoadingManager();
                var loader = new THREE.OBJLoader(manager);
                loader.load(filename, function (object) {
                    object.traverse(function (child) {
                        if (child instanceof THREE.Mesh) {
                            child.material.map = btex;
                            child.material.side = THREE.DoubleSide;
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });
                    object.position.y = 1;
                    object.rotation.x = -Math.PI / 2;
                    object.rotation.z = 2.25;
                    object.scale.x = object.scale.y = object.scale.z = 100;
                    scene.add(object);
                }, undefined, undefined);
            }

            create('stonehenge.obj');
            create('banners.obj');

            var audioLoader = new THREE.AudioLoader();
            var listener = new THREE.AudioListener();
            camera.add(listener);
            /*var sound4 = new THREE.Audio(listener);
            audioLoader.load('ambience.mp3', function (buffer) {
                sound4.setBuffer(buffer);
                sound4.setLoop(true);
                sound4.setVolume(0.5);
                sound4.play();
            },
            function (xhr) {
                console.log((xhr.loaded / xhr.total * 100) + '% loaded');
            },
            function (xhr) {
                console.log('An error happened');
            });*/

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            var render = function () {
                requestAnimationFrame(render);
                renderer.render(scene, camera);
            };

            render();

            function foo(a) {
                elemA = document.getElementById(a).value;
                var code = hashcode(elemA);
                console.log(code);
                if (onedone) {
                    if (code === 0x515a81fa097943dc4f01e32fe178e066b297ee5a00b44fea8c6f7a1cee3b65c140b52e7c0642e82f42e0ebfa17aca7f136aaaccc59ec47f1a62522b680f884bf) {
                        create('reveal.obj');
                        var pass = new Audio("pass.wav");
                        pass.play();
                        document.getElementById("info2").innerHTML = "congratulations <br/> claim your reward, a runic word";
                    }
                    else {
                        $('#b').val('');
                        var fail = new Audio("fail.wav");
                        fail.play();
                    }
                } else {
                    if (parseInt(code,16) === 0x515a81fa097943dc4f01e32fe178e066b297ee5a00b44fea8c6f7a1cee3b65c140b52e7c0642e82f42e0ebfa17aca7f136aaaccc59ec47f1a62522b680f884bf){
                        create('druids.obj');
                        $('#info').hide();
                        $('#info2').show();
                        onedone = true;
                        var pass = new Audio("pass.wav");
                        pass.play();
                    }
                    else {
                        $('#a').val('');
                        var fail = new Audio("fail.wav");
                        fail.play();
                    }
                }
            }
            function hashcode(str) {
                var shaObj = new jsSHA("SHA3-512", "TEXT");
                shaObj.update(str.toLowerCase() + "sodiumchloride");
                var hash = shaObj.getHash("HEX");
                return hash;
            }
        </script>
    </body>
</html>
